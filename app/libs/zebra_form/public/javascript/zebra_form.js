(function(c){c.Zebra_DatePicker=function(G,y){var R={days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),direction:0,disabled_dates:!1,first_day_of_week:1,format:"Y-m-d",months:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),offset:[20,-5],inside:!0,readonly_element:!0,show_week_number:!1,view:"days",weekend_days:[0,6]},p,j,r,s,v,z,A,J,H,O,m,e,t,o,f,K,E,D,I,F,q,x,L,M,d=this;d.settings={};var B=c(G);d.hide=function(){P("hide"); j.css("display","none")};d.show=function(){C();var a=j.outerWidth(),b=j.outerHeight(),u=r.offset().left+d.settings.offset[0],h=r.offset().top-b+d.settings.offset[1],g=c(window).width(),l=c(window).height(),f=c(window).scrollTop(),i=c(window).scrollLeft();u+a>i+g&&(u=i+g-a);u<i&&(u=i);h+b>f+l&&(h=f+l-b);h<f&&(h=f);j.css({left:u,top:h});j.fadeIn(c.browser.msie&&c.browser.version.match(/^[6-8]/)?0:150,"linear");P()};var T=function(a){if(""!=c.trim(a)){for(var b=S(d.settings.format.replace(/\s/g,"")), u="d,D,j,l,N,S,w,F,m,M,n,Y,y".split(","),h=[],g=[],l=0;l<u.length;l++)-1<(position=b.indexOf(u[l]))&&h.push({character:u[l],position:position});h.sort(function(a,b){return a.position-b.position});c.each(h,function(a,b){switch(b.character){case "d":g.push("0[1-9]|[12][0-9]|3[01]");break;case "D":g.push("[a-z]{3}");break;case "j":g.push("[1-9]|[12][0-9]|3[01]");break;case "l":g.push("[a-z]+");break;case "N":g.push("[1-7]");break;case "S":g.push("st|nd|rd|th");break;case "w":g.push("[0-6]");break;case "F":g.push("[a-z]+"); break;case "m":g.push("0[1-9]|1[012]+");break;case "M":g.push("[a-z]{3}");break;case "n":g.push("[1-9]|1[012]");break;case "Y":g.push("[0-9]{4}");break;case "y":g.push("[0-9]{2}")}});if(g.length&&(h.reverse(),c.each(h,function(a,c){b=b.replace(c.character,"("+g[g.length-a-1]+")")}),g=RegExp("^"+b+"$","ig"),segments=g.exec(a.replace(/\s/g,"")))){var f,k,j,m="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),e="January,February,March,April,May,June,July,August,September,October,November,December".split(","), o,n=!0;h.reverse();c.each(h,function(a,b){if(!n)return!0;switch(b.character){case "m":case "n":k=i(segments[a+1]);break;case "d":case "j":f=i(segments[a+1]);break;case "D":case "l":case "F":case "M":o="D"==b.character||"l"==b.character?d.settings.days:d.settings.months;n=!1;c.each(o,function(g,c){if(n)return!0;if(segments[a+1].toLowerCase()==c.substring(0,"D"==b.character||"M"==b.character?3:c.length).toLowerCase()){switch(b.character){case "D":segments[a+1]=m[g].substring(0,3);break;case "l":segments[a+ 1]=m[g];break;case "F":segments[a+1]=e[g];k=g+1;break;case "M":segments[a+1]=e[g].substring(0,3),k=g+1}n=!0}});break;case "Y":j=i(segments[a+1]);break;case "y":j="19"+i(segments[a+1])}});if(n&&(a=new Date(j,k-1,f),a.getFullYear()==j&&a.getDate()==f&&a.getMonth()==k-1))return a}return!1}},U=function(a){c.browser.mozilla?a.css("MozUserSelect","none"):c.browser.msie?a.bind("selectstart",function(){return!1}):a.mousedown(function(){return!1})},S=function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g, "\\$1")},V=function(a){for(var b="",c=a.getDate(),h=a.getDay(),g=d.settings.days[h],l=a.getMonth()+1,f=d.settings.months[l-1],a=a.getFullYear()+"",i=0;i<d.settings.format.length;i++){var j=d.settings.format.charAt(i);switch(j){case "y":a=a.substr(2);case "Y":b+=a;break;case "m":l=k(l,2);case "n":b+=l;break;case "M":f=f.substr(0,3);case "F":b+=f;break;case "d":c=k(c,2);case "j":b+=c;break;case "D":g=g.substr(0,3);case "l":b+=g;break;case "N":h++;case "w":b+=h;break;case "S":b=1==c%10&&"11"!=c?b+"st": 2==c%10&&"12"!=c?b+"nd":3==c%10&&"13"!=c?b+"rd":b+"th";break;default:b+=j}}return b},Q=function(){var a=(new Date(f,o+1,0)).getDate(),b=(new Date(f,o,1)).getDay(),u=(new Date(f,o,0)).getDate(),b=b-d.settings.first_day_of_week,b=0>b?7+b:b;N(d.settings.months[o]+", "+f);var h="<tr>";d.settings.show_week_number&&(h+="<th>"+d.settings.show_week_number+"</th>");for(var g=0;7>g;g++)h+="<th>"+d.settings.days[(d.settings.first_day_of_week+g)%7].substr(0,2)+"</th>";h+="</tr><tr>";for(g=0;42>g;g++){0<g&&0== g%7&&(h+="</tr><tr>");if(0==g%7&&d.settings.show_week_number)var l=new Date(f,o,g),l=Math.ceil(((l-new Date(f,0,1))/864E5+l.getDay()+1)/7),h=h+('<td class="dp_week_number">'+l+"</td>");l=g-b+1;if(g<b)h+='<td class="dp_not_in_month">'+(u-b+g+1)+"</td>";else if(l>a)h+='<td class="dp_not_in_month">'+(l-a)+"</td>";else{var j=(d.settings.first_day_of_week+g)%7,m=i(n(f,k(o,2),k(l,2))),e="";w(m)?e=-1<c.inArray(j,d.settings.weekend_days)?"dp_weekend_disabled":e+" dp_disabled":(-1<c.inArray(j,d.settings.weekend_days)&& (e="dp_weekend"),o==E&&f==D&&K==l?e+=" dp_selected":o==J&&f==H&&O==l&&(e+=" dp_current"));h+="<td"+(""!=e?' class="'+c.trim(e)+'"':"")+">"+k(l,2)+"</td>"}}v.html(c(h+"</tr>"));v.css("display","")},P=function(a){if(c.browser.msie&&c.browser.version.match(/^6/)){if(!F){var b=i(j.css("zIndex"))-1;F=jQuery("<iframe>",{src:'javascript:document.write("")',scrolling:"no",frameborder:0,allowtransparency:"true",css:{zIndex:b,position:"absolute",top:-1E3,left:-1E3,width:j.outerWidth(),height:j.outerHeight(), filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)",display:"none"}});c("body").append(F)}switch(a){case "hide":F.css("display","none");break;default:a=j.offset(),F.css({top:a.top,left:a.left,display:"block"})}}},w=function(a){if(0!==q){var b=(a+"").length;if(8==b&&(q&&(a<n(e,k(m,2),k(t,2))||"undefined"!=typeof x&&a>x)||!q&&(a>n(e,k(m,2),k(t,2))||"undefined"!=typeof x&&a<x))||6==b&&(q&&(a<n(e,k(m,2))||"undefined"!=typeof x&&a>M)||!q&&(a>n(e,k(m,2))||"undefined"!=typeof x&&a<M))||4==b&&(q&& (a<e||"undefined"!=typeof x&&a>L)||!q&&(a>e||"undefined"!=typeof x&&a<L)))return!0}if(I){var a=a+"",d=i(a.substr(0,4)),h=i(a.substr(4,2))+1,g=i(a.substr(6,2)),l=!1;c.each(I,function(){if(!l&&(-1<c.inArray(d,this[2])||-1<c.inArray("*",this[2])))if(void 0!=h&&-1<c.inArray(h,this[1])||-1<c.inArray("*",this[1]))if(void 0!=g&&-1<c.inArray(g,this[0])||-1<c.inArray("*",this[0])){if("*"==this[3])return l=!0;var a=(new Date(d,h-1,g)).getDay();if(-1<c.inArray(a,this[3]))return l=!0}});if(l)return!0}return!1}, N=function(a){s.find(".dp_caption").html(a);if(0!==q){var a=f,b=o,c,d;"days"==p?(d=0>b-1?n(a-1,11):n(a,k(b-1,2)),c=11<b+1?n(a+1,"00"):n(a,k(b+1,2))):"months"==p?(d=a-1,c=a+1):"years"==p&&(d=a-7,c=a+7);w(d)?(s.find(".dp_previous").addClass("dp_blocked"),s.find(".dp_previous").removeClass("dp_hover")):s.find(".dp_previous").removeClass("dp_blocked");w(c)?(s.find(".dp_next").addClass("dp_blocked"),s.find(".dp_next").removeClass("dp_hover")):s.find(".dp_next").removeClass("dp_blocked")}},C=function(){if(""== v.text()||"days"==p){if(""==v.text()){j.css({left:-1E3,display:"block"});Q();var a=v.outerWidth(),b=v.outerHeight();s.css("width",a);z.css({width:a,height:b});A.css({width:a,height:b});j.css({display:"none"})}else Q();z.css("display","none");A.css("display","none")}else if("months"==p){N(f);a="<tr>";for(b=0;12>b;b++){0<b&&0==b%3&&(a+="</tr><tr>");var e="dp_month_"+b,h=i(n(f,k(b,2)));w(h)?e+=" dp_disabled":E&&E==b&&D==f?e+=" dp_selected":J==b&&H==f&&(e+=" dp_current");a+='<td class="'+c.trim(e)+'">'+ d.settings.months[b].substr(0,3)+"</td>"}z.html(c(a+"</tr>"));z.css("display","");v.css("display","none");A.css("display","none")}else if("years"==p){N(f-7+" - "+(f+4));a="<tr>";for(b=0;12>b;b++)0<b&&0==b%3&&(a+="</tr><tr>"),e="",h=i(f-7+b),w(h)?e+=" dp_disabled":D&&D==f-7+b?e+=" dp_selected":H==f-7+b&&(e+=" dp_current"),a+="<td"+(""!=c.trim(e)?' class="'+c.trim(e)+'"':"")+">"+(f-7+b)+"</td>";A.html(c(a+"</tr>"));A.css("display","");v.css("display","none");z.css("display","none")}},k=function(a,b){for(a+= "";a.length<b;)a="0"+a;return a},n=function(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b]+"";return a},i=function(a){return parseInt(!0===a||!1===a?0:a,10)};d._keyup=function(a){("block"==j.css("display")||27==a.which)&&d.hide();return!0};d._mousedown=function(a){if("block"==j.css("display")){if(c(a.target).get(0)===r.get(0))return!0;0==c(a.target).parents().filter(".Zebra_DatePicker").length&&d.hide()}return!0};(function(){d.settings=c.extend({},R,y);d.settings.readonly_element&&B.attr("readonly", "readonly");r=c('<button type="button" class="Zebra_DatePicker_Icon">Pick a date</button>');d.icon=r;q=!c.isArray(d.settings.direction)&&(!0===d.settings.direction||0<i(d.settings.direction))||c.isArray(d.settings.direction)&&2==d.settings.direction.length&&(!0===d.settings.direction[0]||0<i(d.settings.direction[0]))?!0:!c.isArray(d.settings.direction)&&(!1===d.settings.direction||0>i(d.settings.direction))||c.isArray(d.settings.direction)&&2==d.settings.direction.length&&(!1===d.settings.direction[0]|| 0>i(d.settings.direction[0]))?!1:0;var a=new Date;m=a.getMonth();J=a.getMonth();e=a.getFullYear();H=a.getFullYear();t=a.getDate();O=a.getDate();0!==q&&(a=new Date(e,m,t+i(c.isArray(d.settings.direction)?d.settings.direction[0]:d.settings.direction)),m=a.getMonth(),e=a.getFullYear(),t=a.getDate());0!==q&&c.isArray(d.settings.direction)&&2==d.settings.direction.length&&(a=new Date(e,m,t+(0<q?1:-1)*i(d.settings.direction[1])),x=i(n(a.getFullYear(),k(a.getMonth(),2),k(a.getDate(),2))),M=i(n(a.getFullYear(), k(a.getMonth(),2))),L=i(n(a.getFullYear())));if(w(n(e,k(m,2),k(t,2)))){for(;w(e);)q?e++:e--,m=0;for(;w(n(e,k(m,2)));)q?m++:m--,11<m?(e++,m=0):0>m&&(e--,m=0),t=1;for(;w(n(e,k(m,2),k(t,2)));)q?t++:t--,a=new Date(e,m,t),e=a.getFullYear(),m=a.getMonth(),t=a.getDate()}(d.settings.readonly_element?r.add(B):r).bind("click",function(a){a.preventDefault();p=d.settings.view;"none"!=j.css("display")?d.hide():((a=T(B.val()))?(E=a.getMonth(),o=a.getMonth(),D=a.getFullYear(),f=a.getFullYear(),K=a.getDate(),w(n(D, k(E,2),k(K,2)))&&(o=m,f=e)):(o=m,f=e),C(),d.show())});r.insertAfter(G);if(d.settings.inside){r.addClass("Zebra_DatePicker_Icon_Inside");B.position();B.outerWidth(!0);var a=B.outerHeight(!0),b=r.position().top,u=r.outerWidth(!0),h=r.outerHeight(!0);r.css({left:-u,top:-b+(a-h)/2})}j=c('<div class="Zebra_DatePicker"><table class="dp_header"><tr><td class="dp_previous">&laquo;</td><td class="dp_caption">&nbsp;</td><td class="dp_next">&raquo;</td></tr></table><table class="dp_daypicker"></table><table class="dp_monthpicker"></table><table class="dp_yearpicker"></table></div>'); d.datepicker=j;s=j.find("table.dp_header").first();v=j.find("table.dp_daypicker").first();z=j.find("table.dp_monthpicker").first();A=j.find("table.dp_yearpicker").first();c("body").append(j);j.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)","mouseover",function(){c(this).addClass("dp_hover")}).delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)","mouseout",function(){c(this).removeClass("dp_hover")}); U(s.find("td"));s.find(".dp_previous").bind("click",function(){c(this).hasClass("dp_blocked")||("months"==p?f--:"years"==p?f-=12:0>--o&&(o=11,f--),C())});s.find(".dp_caption").bind("click",function(){p="days"==p?"months":"months"==p?"years":"days";C()});s.find(".dp_next").bind("click",function(){c(this).hasClass("dp_blocked")||("months"==p?f++:"years"==p?f+=12:12==++o&&(o=0,f++),C())});v.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_week_number)","click",function(){B.val(V(new Date(f, o,i(c(this).html()))));d.hide()});z.delegate("td:not(.dp_disabled)","click",function(){var a=c(this).attr("class").match(/dp\_month\_([0-9]+)/);o=i(a[1]);p="days";C()});A.delegate("td:not(.dp_disabled)","click",function(){f=i(c(this).html());p="months";C()});c(document).bind({mousedown:d._mousedown,keyup:d._keyup});I=[];c.each(d.settings.disabled_dates,function(){for(var a=this.split(" "),b=0;4>b;b++){a[b]||(a[b]="*");a[b]=-1<c.inArray(",",a[b])?a[b].split(","):Array(a[b]);for(var d=0;d<a[b].length;d++)if(-1< c.inArray("-",a[b][d])){var e=a[b][d].match(/^([0-9]+)\-([0-9]+)/);if(null!=e){for(var f=i(e[1]);f<=i(e[2]);f++)-1==c.inArray(f,a[b])&&a[b].push(f+"");a[b].splice(d,1)}}for(d=0;d<a[b].length;d++)a[b][d]=isNaN(i(a[b][d]))?a[b][d]:i(a[b][d])}I.push(a)})})()};c.fn.Zebra_DatePicker=function(G){return this.each(function(){if(void 0!=c(this).data("Zebra_DatePicker")){var y=c(this).data("Zebra_DatePicker");y.icon.remove();y.datepicker.remove();c(document).unbind("keyup",y._keyup);c(document).unbind("mousedown", y._mousedown)}y=new c.Zebra_DatePicker(this,G);c(this).data("Zebra_DatePicker",y)})}})(jQuery);(function(e){e.Zebra_Form=function(o,u){var f=this,I={scroll_to_error:!0,tips_position:"left",close_tips:!0,assets_path:null};f.settings={};var m={},E={},r={},s=[],v=!1,i=e(o),J=o;f.filter_input=function(a,b,d){var c,e="";if(window.event)c=window.event.keyCode,b=window.event;else if(b)c=b.which;else return!0;switch(a){case "alphabet":e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case "digits":case "number":case "float":e="0123456789";break;case "alphanumeric":e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"; break;default:return!0}d&&(e+=d);b=b.srcElement?b.srcElement:b.target||b.currentTarget;if(null==c||0==c||8==c||9==c||13==c||27==c)return!0;c=String.fromCharCode(c);return-1<e.indexOf(c)||"number"==a&&"-"==c&&0==y(b)||"float"==a&&("-"==c&&0==y(b)||"."==c&&0!=y(b)&&null==b.value.match(/\./))?!0:!1};f.init=function(){f.settings=e.extend({},I,u);i.find("option.dummy").remove();i.find("div.error").each(function(){var a=e(this);a.first("div.close a").click(function(b){b.preventDefault();a.animate({height:0, opacity:0},250,function(){a.remove()})})});i.find(".control").each(function(){var a=e(this),b={id:a.attr("id"),type:C(a)},d=a.closest(".row");d.length&&a.bind({focus:function(){d.addClass("highlight")},blur:function(){d.removeClass("highlight")}});if(a.hasClass("inner-label")&&("text"==b.type||"password"==b.type||"textarea"==b.type)){var c=a.position(),g=jQuery("<span>").attr({"class":"Zebra_Form_Placeholder"}).css({display:"none",left:c.left,top:c.top}).html("text"==b.type||"password"==b.type?a.attr("alt"): a.attr("title")).insertAfter(a);a.removeAttr("title");g.bind("click",function(){a.focus()});a.bind({focus:function(){g.css("display","none")},blur:function(){""==a.val()&&g.css("display","block")}});a.data("Zebra_Form_Placeholder",g);s.push(a)}else a.hasClass("other")&&"select-one"==b.type&&(z(a),a.change(function(){z(a)}));void 0!=f.settings.error_messages&&void 0!=typeof f.settings.error_messages[b.id]&&f.register(a,!1);if(("text"==b.type||"textarea"==b.type||"password"==b.type)&&a.attr("maxlength"))if(a.data("maxlength", a.attr("maxlength")),a.bind("keyup",function(){var a=e(this),b=a.data("maxlength"),d=F(a);a.attr("maxlength",b-d);a.hasClass("show-character-counter")&&(a=b-d-a.val().length,p.html(0>a?"<span>"+a+"</span>":a))}),a.hasClass("show-character-counter")){var c=a.position(),p=jQuery("<div>",{"class":"Zebra_Character_Counter",css:{visibility:"hidden"}}).html(a.data("maxlength")).insertAfter(a);width=p.outerWidth();height=p.outerHeight();p.css({top:c.top+a.outerHeight()-height/1.5,left:c.left+a.outerWidth()- width/1.5,width:p.width(),visibility:"visible"});a.trigger("keyup")}});i.bind("submit",function(a){!1==v&&void 0!=f.settings.error_messages&&(f.validate()?void 0==a&&i.submit():(void 0!=a&&a.preventDefault(),f.show_errors()))});0<s.length&&setInterval(K,50)};f.attach_tip=function(a,b){var d=a.attr("id");m[d].message=b;f.show_errors(a)};f.clear_errors=function(){e(".Zebra_Form_error_iFrameShim").remove();e(".Zebra_Form_error_message").remove();r=[]};f.end_file_upload=function(a,b){var d=e("#"+a);if(d.length&& (f.clear_errors(),i.removeAttr("target"),e("#"+a+"_iframe").remove(),e("#"+a+"_spinner").remove(),void 0!=m[a]))if(void 0!=b&&"object"==typeof b&&void 0!=b[0]&&void 0!=b[1]&&void 0!=b[2]&&void 0!=b[3]&&d.data("file_info",b),!0!==f.validate_control(d))d.val(""),d.css("opacity","1"),f.show_errors(d);else{var c=d.offset(),g=jQuery("<div>",{"class":"Zebra_Form_filename",css:{left:c.left,top:c.top,width:d.outerWidth,opacity:0}}).html(b[0]),c=jQuery("<a>",{href:"javascript:void(0)"}).html("x").bind("click", function(a){a.preventDefault();g.remove();d.val("");d.data("file_info")&&d.removeData("file_info");d.css("opacity",1)});e("body").append(g.append(c));g.css({top:parseInt(g.css("top"),10)+(d.outerHeight()-g.outerHeight())/2,opacity:1})}};f.hide_error=function(a){var b=r[a];void 0!=b&&"object"==typeof b&&b.animate({opacity:0},250,function(){var d=b.data("shim");void 0!=d&&d.remove();b.remove();delete r[a]})};f.register=function(a,b){var d={id:a.attr("id"),name:a.attr("name"),type:C(a)};d.name=d.name.replace(/\[\]$/, "");switch(d.type){case "radio":case "checkbox":a.bind({click:function(){f.hide_error(d.name)},blur:function(){f.hide_error(d.name)}});void 0==E[d.id]&&(E[d.id]=i.find("input[name^="+d.name+"]"));break;case "file":var c=a.clone(!0);c.attr("value","");a.replaceWith(c);c.bind({keypress:function(a){a.preventDefault();c.attr("value","")},change:function(){f.hide_error(d.name);c.data("file_info")&&c.removeData("file_info");var a=jQuery("<iframe>",{src:"javascript:void(0)",id:d.id+"_iframe",name:d.id+"_iframe", scrolling:"no",marginwidth:0,marginheight:0,width:0,height:0,frameborder:0,allowTransparency:"true"});e("body").append(a);a=i.attr("action");i.attr("action",f.settings.assets_path+"process.php?form="+i.attr("id")+"&control="+d.id+"&nocache="+(new Date).getTime());i.attr("target",d.id+"_iframe");c.css("opacity",0);var b=c.offset(),b=jQuery("<div>",{id:d.id+"_spinner","class":"Zebra_Form_spinner",css:{left:b.left,top:b.top}});e("body").append(b);v=!0;i.trigger("submit");i.attr("action",a);v=!1},blur:function(){f.hide_error(d.name)}}); a=c;break;case "select-one":case "select-multiple":a.bind({change:function(){f.hide_error(d.name)},blur:function(){f.hide_error(d.name)}});break;default:a.blur(function(){f.hide_error(d.name)})}var g=a.attr("class").match(/validate\[(.+)\]/);if(null!=g){for(var p=/([^\,]*\(.*?\)|[^\,]+)/g,h={};matches=p.exec(g[1]);){var l=matches[1].match(/^([^\(]+)/),j=matches[1].match(/\((.*?)\)/);j?(j=j[1].split(","),e.each(j,function(a){j[a]=j[a].replace(/lsqb\;/g,"[");j[a]=j[a].replace(/rsqb\;/g,"]");j[a]=j[a].replace(/comma\;/g, ",");j[a]=j[a].replace(/lsb\;/g,"(");j[a]=j[a].replace(/rsb\;/g,")")})):j=null;h[l[1]]=j}if(void 0==b){var n=i.find(".control");e.each(n,function(b,c){if(c==a.get(0)){e(c);for(var f=null,g=b-1;null==f&&void 0!=n[g];)f=e(n[g]).attr("id"),g--;if(m[f]){g={};for(b in m)g[b]=m[b],f==b&&(g[d.id]={element:a,rules:h});m=g}else f={},f[d.id]={element:a,rules:h},e.extend(m,f)}})}else if(void 0!=b&&e("#"+b).length){e("#"+b).attr("id");g={};for(index in m)g[index]=m[index],previous_element_id==index&&(g[d.id]= {element:a,rules:h});m=g}else void 0!=b&&!1===b&&(m[d.id]={element:a,rules:h})}};f.show_errors=function(a){f.clear_errors();var b=0;for(index in m){var d=m[index],c=d.element,g={id:c.attr("id"),name:c.attr("name"),type:C(c)};g.name=g.name.replace(/\[\]$/,"");if(!(void 0!=a&&a.get(0)!=c.get(0))&&void 0!=d.message){"none"!=c.css("display")&&c.focus();var p=e.extend(c.offset()),p=e.extend(p,{right:Math.floor(p.left+c.width())}),a=jQuery("<div/>",{"class":"Zebra_Form_error_message",css:{opacity:0}}), d=jQuery("<div/>",{"class":"message"+(!f.settings.close_tips?" noclose":""),css:{width:"auto"}}).html(d.message).appendTo(a);if(f.settings.close_tips)var h=jQuery("<a/>",{href:"javascript:void(0)","class":"close"+(e.browser.msie&&e.browser.version.match(/^6/)?"-ie6":"")}).html("x").bind({click:function(a){a.preventDefault();f.hide_error(g.name)},focus:function(){h.blur()}}).appendTo(d);var l=jQuery("<div/>",{"class":"arrow"}).appendTo(a);e("body").append(a);var j=a.outerWidth(),n=a.outerHeight(), n=l.outerWidth(),d=l.outerHeight(),i=("left"==f.settings.tips_position?p.left:p.right)-j/2;l.css("left",j/2-n/2-1);if("radio"==g.type||"checkbox"==g.type)i=p.right-j/2-c.outerWidth()/2+1;0>i&&(i=2);a.css("left",i);j=a.outerWidth();n=a.outerHeight();c=p.top-n+d/2-1;0>c&&(c=2);a.css({left:i+"px",top:c+"px",height:n-d/2+"px"});r["radio"==g.type||"checkbox"==g.type?g.name:g.id]=a;L(a);a.animate({opacity:0.9},250);1==++b&&f.settings.scroll_to_error&&e("html, body").animate({scrollTop:a.css("top").replace(/px/, "")-10},250);break}}};f.submit=function(){void 0!=f.settings.error_messages?i.trigger("submit"):J.submit()};f.validate_control=function(a){var b={id:a.attr("id"),type:C(a)},d=!0,c=m[b.id];if(void 0!=c&&"none"!=a.css("display")&&"hidden"!=a.css("visibility")){var g=null,i=null;delete c.message;for(var h in c.rules){if(!d)break;switch(h){case "alphabet":switch(b.type){case "password":case "text":case "textarea":var l=RegExp("^[a-z"+w(c.rules[h][0]).replace(/\s/,"\\s")+"]+$","ig");""!=e.trim(a.val())&& !l.test(a.val())&&(d=!1)}break;case "alphanumeric":switch(b.type){case "password":case "text":case "textarea":l=RegExp("^[a-z0-9"+w(c.rules[h][0]).replace(/\s/,"\\s")+"]+$","ig"),""!=e.trim(a.val())&&!l.test(a.val())&&(d=!1)}break;case "compare":switch(b.type){case "password":case "text":case "textarea":if(!e("#"+c.rules[h][0])||a.val()!=e("#"+c.rules[h][0]).val())d=!1}break;case "custom":var j=!1;e.each(c.rules[h],function(b,c){if(!j){var c=e.map(c.split(","),function(a){return a.replace(/mark\;/g, ",")}),c=e.merge(e.merge([c.shift()],[a.val()]),c),f="function"==typeof c[0]?c[0]:"function"==typeof window[c[0]]?window[c[0]]:!1;if(!1!==f)d=f.apply(f,c.slice(1));else throw d=!1,Error('Function "'+c[0]+"\" doesn't exist!");d||(i=c[0],j=!0)}});break;case "date":switch(b.type){case "text":if(""!=e.trim(a.val())){for(var l=!1,n=a.data("Zebra_DatePicker").settings.format.replace(/\s/g,""),o="d,D,j,l,N,S,w,F,m,M,n,Y,y,G,H,g,h,a,A,i,s,U".split(","),t=[],k=[],n=w(n),r=0;r<o.length;r++)-1<(position=n.indexOf(o[r]))&& t.push({character:o[r],position:position});t.sort(function(a,b){return a.position-b.position});e.each(t,function(a,b){switch(b.character){case "d":k.push("0[1-9]|[12][0-9]|3[01]");break;case "D":k.push("[a-z]{3}");break;case "j":k.push("[1-9]|[12][0-9]|3[01]");break;case "l":k.push("[a-z]+");break;case "N":k.push("[1-7]");break;case "S":k.push("st|nd|rd|th");break;case "w":k.push("[0-6]");break;case "F":k.push("[a-z]+");break;case "m":k.push("0[1-9]|1[012]+");break;case "M":k.push("[a-z]{3}");break; case "n":k.push("[1-9]|1[012]");break;case "Y":k.push("[0-9]{4}");break;case "y":k.push("[0-9]{2}");break;case "G":case "H":case "g":case "h":k.push("[0-9]{1,2}");break;case "a":case "A":k.push("(am|pm)");break;case "i":case "s":k.push("[012345][0-9]")}});if(0<k.length&&(t.reverse(),e.each(t,function(a,b){n=n.replace(b.character,"("+k[k.length-a-1]+")")}),k=RegExp("^"+n+"$","ig"),segments=k.exec(a.val().replace(/\s/g,"")))){var D=null,x=null,A=null,u="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","), s="January,February,March,April,May,June,July,August,September,October,November,December".split(","),v=null,B=!0;t.reverse();e.each(t,function(b,c){if(!B)return!0;switch(c.character){case "m":case "n":x=parseInt(segments[b+1],10);break;case "d":case "j":D=parseInt(segments[b+1],10);break;case "D":case "l":case "F":case "M":v="D"==c.character||"l"==c.character?a.data("Zebra_DatePicker").settings.days:a.data("Zebra_DatePicker").settings.months;B=!1;e.each(v,function(a,d){if(B)return!0;if(segments[b+ 1].toLowerCase()==d.substring(0,"D"==c.character||"M"==c.character?3:d.length).toLowerCase()){switch(c.character){case "D":segments[b+1]=u[a].substring(0,3);break;case "l":segments[b+1]=u[a];break;case "F":segments[b+1]=s[a];x=a+1;break;case "M":segments[b+1]=s[a].substring(0,3),x=a+1}B=!0}});break;case "Y":A=parseInt(segments[b+1],10);break;case "y":A="19"+parseInt(segments[b+1],10)}});B&&(o=new Date(A,x-1,D),o.getFullYear()==A&&o.getDate()==D&&o.getMonth()==x-1&&(a.data("timestamp",Date.parse(s[x- 1]+" "+D+", "+A)),l=!0))}l||(d=!1)}}break;case "datecompare":switch(b.type){case "password":case "text":case "textarea":if(void 0!=c.rules[h][0]&&void 0!=c.rules[h][1]&&e(c.rules[h][0])&&!0===f.validate_control(e(c.rules[h][0]))&&void 0!=a.data("timestamp"))switch(c.rules[h][1]){case ">":d=a.data("timestamp")>e("#"+c.rules[h][0]).data("timestamp");break;case ">=":d=a.data("timestamp")>=e("#"+c.rules[h][0]).data("timestamp");break;case "<":d=a.data("timestamp")<e("#"+c.rules[h][0]).data("timestamp"); break;case "<=":d=a.data("timestamp")<=e("#"+c.rules[h][0]).data("timestamp")}else d=!1}break;case "digits":switch(b.type){case "password":case "text":case "textarea":l=RegExp("^[0-9"+w(c.rules[h][0]).replace(/\s/,"\\s")+"]+$","ig"),""!=e.trim(a.val())&&!l.test(a.val())&&(d=!1)}break;case "email":switch(b.type){case "password":case "text":case "textarea":""!=e.trim(a.val())&&null==a.val().match(/^([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+@{1}([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+\.[A-Za-z0-9]{2,}$/)&&(d=!1)}break; case "emails":switch(b.type){case "password":case "text":case "textarea":a.val().split(",").each(function(a){""!=e.trim(a)&&null==e.trim(a).match(/^([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+@{1}([a-zA-Z0-9_\-\+\~\^\{\}]+[\.]?)+\.[A-Za-z0-9]{2,}$/)&&(d=!1)})}break;case "filesize":switch(b.type){case "file":var q=a.data("file_info");if(q&&(void 0==q[2]||void 0==q[3]||0!=q[2]||parseInt(q[3],10)>parseInt(c.rules[h][0],10)))d=!1}break;case "filetype":switch(b.type){case "file":if(q=a.data("file_info")){void 0== f.mimes&&e.ajax({url:f.settings.assets_path+"mimes.json",async:!1,success:function(a){f.mimes=a},dataType:"json"});var y=e.map(c.rules[h][0].split(","),function(a){return e.trim(a)}),z=[];e.each(f.mimes,function(a,b){(e.isArray(b)&&-1<e.inArray(q[1],b)||!e.isArray(b)&&b==q[1])&&z.push(a)});var G=!1;e.each(z,function(a,b){-1<e.inArray(b,y)&&(G=!0)});G||(d=!1)}}break;case "float":switch(b.type){case "password":case "text":case "textarea":if(l=RegExp("^[0-9-."+w(c.rules[h][0]).replace(/\s/,"\\s")+"]+$", "ig"),""!=e.trim(a.val())&&("-"==e.trim(a.val())||"."==e.trim(a.val())||null!=a.val().match(/\-/g)&&1<a.val().match(/\-/g).length||null!=a.val().match(/\./g)&&1<a.val().match(/\./g).length||0<a.val().indexOf("-")||!l.test(a.val())))d=!1}break;case "image":switch(b.type){case "file":(q=a.data("file_info"))&&null==q[1].match(/image\/(gif|jpeg|png|pjpeg)/i)&&(d=!1)}break;case "length":switch(b.type){case "password":case "text":case "textarea":if(""!=a.val()&&void 0!=c.rules[h][0]&&a.val().length-F(a)< c.rules[h][0]||void 0!=c.rules[h][1]&&0<c.rules[h][1]&&a.val().length-F(a)>c.rules[h][1])d=!1}break;case "number":switch(b.type){case "password":case "text":case "textarea":if(l=RegExp("^[0-9-"+w(c.rules[h][0]).replace(/\s/,"\\s")+"]+$","ig"),""!=e.trim(a.val())&&("-"==e.trim(a.val())||null!=a.val().match(/\-/g)&&1<a.val().match(/\-/g).length||0<a.val().indexOf("-")||!l.test(a.val())))d=!1}break;case "regexp":switch(b.type){case "password":case "text":case "textarea":l=RegExp(c.rules[h][0],"g"),""!= e.trim(a.val())&&null==l.exec(a.val())&&(d=!1)}break;case "required":switch(b.type){case "checkbox":case "radio":var H=!1;E[b.id].each(function(){this.checked&&(H=!0)});H||(d=!1);break;case "file":case "password":case "text":case "textarea":""==e.trim(a.val())&&(d=!1);break;case "select-one":if(a.hasClass("other")&&"other"==a.val()&&(!e("#"+b.id+"_other").length||""==e.trim(e("#"+b.id+"_other").val()))||0==a.get(0).selectedIndex)d=!1;break;case "select-multiple":-1==a.get(0).selectedIndex&&(d=!1)}}d|| (g=h,c.message=f.settings.error_messages[b.id]["custom"==h?"custom_"+i:g],c.value=a.val())}}return d?!0:g};f.validate=function(){var a=!0;for(index in m){if(!a)break;o=m[index].element;o.attr("id");if(!0!==(rule_not_passed=f.validate_control(o))){a=!1;break}}return a&&void 0!=f.settings.onValid?f.settings.onValid():a};var K=function(){e.each(s,function(){var a=e(this),b=a.data("Zebra_Form_Placeholder");""==a.val()&&!a.is(":focus")?b.css("display","block"):b.css("display","none")})},w=function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g, "\\$1")},y=function(a){if(null!=a.selectionStart)return a.selectionStart;var b=document.selection.createRange(),d=b.duplicate();if("text"==a.type)return 0-d.moveStart("character",-1E5);var c=a.value.length;d.moveToElementText(a);d.setEndPoint("StartToStart",b);return c-d.text.length},F=function(a){var a=a.val(),b=a.length;return a.replace(/(\r\n|\r|\n)/g,"\r\n").length-b},L=function(a){if(e.browser.msie&&e.browser.version.match(/^6/)&&!a.data("shim")){var b=a.offset(),d=parseInt(a.css("zIndex"),10)- 1,b=jQuery("<iframe>",{src:'javascript:document.write("")',scrolling:"no",frameborder:0,allowTransparency:"true","class":"Zebra_Form_error_iFrameShim",css:{zIndex:d,position:"absolute",top:b.top,left:b.left,width:a.outerWidth(),height:a.outerHeight(),filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)",display:"block"}});e("body").append(b);a.data("shim",b)}},z=function(a){var b=e("#"+a.attr("id")+"_other");"other"==a.val()?b.css("display","block"):b.css("display","none")},C=function(a){var b= "button,input:checkbox,input:file,input:password,input:radio,input:submit,input:text,select,textarea".split(",");for(index in b)if(a.is(b[index]))return"select"==b[index]?a.attr("multiple")?"select-multiple":"select-one":b[index].replace(/input\:/,"")};f.init()};e.fn.Zebra_Form=function(o){return this.each(function(){var u=new e.Zebra_Form(this,o);e(this).data("Zebra_Form",u)})}})(jQuery);